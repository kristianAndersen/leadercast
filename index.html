<!DOCTYPE html>
<html>
<head>
    <title>Debug Cast Sender</title>
    
    <style>
        body { font-family: Arial; margin: 20px; }
        button { padding: 10px; margin: 5px; }
        .log { 
            border: 1px solid #ccc; 
            padding: 10px; 
            height: 300px; 
            overflow-y: auto;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div>
        <button onclick="initCustom()">Try Custom Receiver</button>
        <button onclick="initDefault()">Try Default Receiver</button>
        <button onclick="checkState()">Check State</button>
    </div>
    <div id="log" class="log"></div>

    <script>
        const CUSTOM_APP_ID = '64F29018';
        const DEFAULT_APP_ID = 'CC1AD845';
        let castContext = null;

        function log(msg) {
            const div = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            div.innerHTML = `${time}: ${msg}<br>` + div.innerHTML;
            console.log(msg);
        }

        window['__onGCastApiAvailable'] = function(isAvailable) {
            log(`Cast API available: ${isAvailable}`);
        };

        function initializeWithAppId(appId) {
            try {
                log(`Initializing with app ID: ${appId}`);
                
                // Initialize Cast API
                const sessionRequest = new chrome.cast.SessionRequest(appId);
                const apiConfig = new chrome.cast.ApiConfig(
                    sessionRequest,
                    function(status) {
                        log('Receiver status: ' + status);
                    },
                    function(availability) {
                        log('Receiver availability: ' + availability);
                    },
                    chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED
                );

                chrome.cast.initialize(apiConfig,
                    function() {
                        log('Initialization success');
                        requestSession();
                    },
                    function(error) {
                        log('Initialization error: ' + error.description);
                    }
                );
            } catch (error) {
                log('Error: ' + error.message);
            }
        }

        function initCustom() {
            initializeWithAppId(CUSTOM_APP_ID);
        }

        function initDefault() {
            initializeWithAppId(DEFAULT_APP_ID);
        }

        function requestSession() {
            log('Requesting session...');
            chrome.cast.requestSession(
                function(session) {
                    log('Session created: ' + session.sessionId);
                },
                function(error) {
                    log('Session error: ' + error.description);
                }
            );
        }

        function checkState() {
            if (!chrome.cast || !chrome.cast.isAvailable) {
                log('Cast API not available');
                return;
            }

            log('Cast API is available');
            log('Extension status: ' + (chrome.cast.isAvailable ? 'Loaded' : 'Not loaded'));
        }
    </script>

<script src="//www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
</body>
</html>