<!DOCTYPE html>
<html>
<head>
    <title>Minimal Cast Sender</title>
    <script type="text/javascript" src="//www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
    <style>
        body { padding: 20px; font-family: Arial; }
        button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
        }
        #status {
            margin: 20px 0;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h2>Cast Sender</h2>
    <button onclick="initCast()">Initialize</button>
    <button onclick="connect()">Connect</button>
    <button onclick="sendMessage()">Send Test Message</button>
    <div id="status">Waiting to initialize...</div>

    <script>
        let castContext = null;
        const APP_ID = 'ED052386';

        function updateStatus(message) {
            console.log(message);
            document.getElementById('status').textContent = message;
        }

        // Initialize when Cast API is available
        window['__onGCastApiAvailable'] = function(isAvailable) {
            updateStatus('Cast API available: ' + isAvailable);
            if (isAvailable) initCast();
        };

        function initCast() {
            try {
                updateStatus('Initializing Cast...');
                
                castContext = cast.framework.CastContext.getInstance();
                castContext.setOptions({
                    receiverApplicationId: APP_ID,
                    autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED,
                    language: 'en-US'
                });

                // Add basic listeners
                castContext.addEventListener(
                    cast.framework.CastContextEventType.CAST_STATE_CHANGED,
                    event => updateStatus('Cast state: ' + event.castState)
                );

                updateStatus('Cast initialized. Ready to connect.');
            } catch (error) {
                updateStatus('Init error: ' + error.message);
            }
        }

        function connect() {
            updateStatus('Requesting session...');
            castContext.requestSession()
                .then(() => updateStatus('Connected!'))
                .catch(error => updateStatus('Connection error: ' + error.message));
        }

        function sendMessage() {
            const session = castContext.getCurrentSession();
            if (!session) {
                updateStatus('No active session');
                return;
            }

            const message = { text: 'Hello!', time: new Date().toISOString() };
            session.sendMessage('urn:x-cast:com.nokbok.helloworld', message)
                .then(() => updateStatus('Message sent'))
                .catch(error => updateStatus('Message error: ' + error.message));
        }
    </script>
</body>
</html>