<!DOCTYPE html>
<html>
<head>
    <title>Cast Sender</title>
   
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .controls {
            margin: 20px 0;
        }
        button {
            padding: 12px 24px;
            margin: 5px;
            background: #4285f4;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:disabled {
            background: #ccc;
        }
        #status {
            padding: 15px;
            margin: 20px 0;
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #debugOutput {
            font-family: monospace;
            padding: 15px;
            margin: 20px 0;
            background: #fff;
            border-radius: 4px;
            height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>Cast Sender</h1>
    <div class="controls">
        <button id="initButton" onclick="checkCastAvailability()">1. Check Availability</button>
        <button id="castButton" onclick="initCast()">2. Initialize Cast</button>
        <button id="connectButton" onclick="startCasting()">3. Connect</button>
        <button id="testButton" onclick="testDefaultReceiver()">Test Default Receiver</button>
    </div>
    <div id="status">Waiting to initialize...</div>
    <div id="debugOutput"></div>

    <script>
        // Configuration
        const CUSTOM_APP_ID = '64F29018';
        const DEFAULT_APP_ID = 'CC1AD845';
        let currentAppId = CUSTOM_APP_ID;
        let castContext = null;
        let isInitialized = false;

        function log(message) {
            const debugOutput = document.getElementById('debugOutput');
            const time = new Date().toLocaleTimeString();
            debugOutput.innerHTML = `${time}: ${message}\n` + debugOutput.innerHTML;
            console.log(message);
        }

        function updateStatus(message) {
            document.getElementById('status').textContent = message;
            log(message);
        }

        // Initialize when Cast API is available
        window['__onGCastApiAvailable'] = function(isAvailable, error) {
            log(`Cast API available: ${isAvailable}${error ? ', Error: ' + error : ''}`);
            if (isAvailable) {
                document.getElementById('initButton').disabled = false;
            }
        };

        function checkCastAvailability() {
            try {
                if (chrome.cast && chrome.cast.isAvailable) {
                    log('Chrome Cast is available');
                    document.getElementById('castButton').disabled = false;
                } else {
                    log('Chrome Cast is not available');
                }
            } catch (error) {
                log(`Error checking Cast availability: ${error.message}`);
            }
        }

        function initCast() {
            try {
                log('Initializing Cast...');
                
                // Initialize Cast API
                const initializeApiConfig = new chrome.cast.ApiConfig(
                    new chrome.cast.SessionRequest(currentAppId),
                    sessionListener,
                    receiverListener,
                    chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED
                );

                chrome.cast.initialize(initializeApiConfig, onInitSuccess, onInitError);

            } catch (error) {
                log(`Initialization error: ${error.message}`);
                console.error('Full error:', error);
            }
        }

        function sessionListener(session) {
            log('New session created: ' + session.sessionId);
            castSession = session;
            document.getElementById('connectButton').disabled = false;
        }

        function receiverListener(availability) {
            log('Receiver availability: ' + availability);
            if (availability === chrome.cast.ReceiverAvailability.AVAILABLE) {
                document.getElementById('connectButton').disabled = false;
            }
        }

        function onInitSuccess() {
            log('Cast initialization successful');
            isInitialized = true;
            document.getElementById('connectButton').disabled = false;
        }

        function onInitError(error) {
            log('Cast initialization failed: ' + error.description);
            console.error('Init error:', error);
        }

        function startCasting() {
            if (!isInitialized) {
                log('Cast not initialized. Please initialize first.');
                return;
            }

            log('Requesting session...');
            chrome.cast.requestSession(
                function(session) {
                    log('Session created successfully');
                    castSession = session;
                },
                function(error) {
                    log('Failed to create session: ' + error.description);
                    console.error('Session error:', error);
                }
            );
        }

        function testDefaultReceiver() {
            currentAppId = DEFAULT_APP_ID;
            log('Switching to default receiver...');
            initCast();
        }

        // Initial setup
        document.getElementById('initButton').disabled = true;
        document.getElementById('castButton').disabled = true;
        document.getElementById('connectButton').disabled = true;
    </script>

     <!-- Add Cast SDK -->
     <script src="//www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
     
</body>
</html>